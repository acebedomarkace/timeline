{% extends 'blog/base.html' %}
{% load static %}

{% block body_class %}theme-{{ profile.theme }}{% endblock %}

{% block title %}{{ author.username }}'s Timeline{% endblock %}

{% block content %}
<style>
    /* Using a more modern font stack */
    .portfolio-header {
        background-color: #fff;
        border-bottom: 1px solid #dee2e6;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }

    .profile-image {
        width: 128px;
        height: 128px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* Tag filtering bar */
    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
    }

    /* Card styles from student_post.html inspiration */
    .post-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }

    .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    

    .fab-circle {
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .theme-vibrant .post-card.color-1 {
        background-color: #e0e7ff;
    }
    .theme-vibrant .post-card.color-2 {
        background-color: #fee2e2;
    }
    .theme-vibrant .post-card.color-3 {
        background-color: #dcfce7;
    }

</style>

<!-- Header -->
<header class="portfolio-header text-center">
    <div class="container">
        <img src="{{ user.profile.image.url }}" alt="{{ user.username }}'s Profile Picture" class="profile-image mx-auto mb-3">
        <h1 class="display-4">{{ author.first_name }} {{ author.last_name }}</h1>
        <p class="lead text-muted">@{{ author.username }}</p>
    </div>
</header>

<div class="container">
    <!-- Tag Filtering -->
    <div class="filter-bar">
        <a href="{% url 'author_post_list' username=author.username %}" class="btn btn-sm {% if not active_tag %}btn-primary{% else %}btn-outline-primary{% endif %} rounded-pill">All Work</a>
        {% for tag in all_tags %}
            <a href="?tag={{ tag.slug }}" class="btn btn-sm {% if active_tag.slug == tag.slug %}btn-primary{% else %}btn-outline-primary{% endif %} rounded-pill">{{ tag.name }}</a>
        {% endfor %}
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for post in posts %}
            {% cycle 'color-1' 'color-2' 'color-3' as card_color silent %}
            <div class="col">
                <div class="card h-100 post-card {% if profile.theme == 'vibrant' %}{{ card_color }}{% endif %}">
                    <a href="{% url 'post_detail' pk=post.pk %}">
                        {% if post.photo %}
                            <img src="{{ post.photo.url }}" class="card-img-top" alt="{{ post.title }}">
                        {% else %}
                            <img src="https://placehold.co/600x400/e2e8f0/4a5568?text=Post" class="card-img-top" alt="Placeholder">
                        {% endif %}
                    </a>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <p class="card-date text-muted">{{ post.created_date|timesince }} ago</p>
                                <a href="{% url 'post_detail' pk=post.pk %}" class="text-decoration-none text-dark">
                                    <h5 class="card-title mb-0">{{ post.title }}</h5>
                                </a>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-link btn-sm" type="button" id="dropdownMenuButton-{{ post.pk }}" data-bs-toggle="dropdown" aria-expanded="false">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                        <path d="M9.5 3.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0zm0 5a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0zm0 5a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0z"/>
                                    </svg>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton-{{ post.pk }}">
                                    <li><a class="dropdown-item" href="{% url 'post_edit' pk=post.pk %}">Edit</a></li>
                                    <li><a class="dropdown-item" href="{% url 'post_delete' pk=post.pk %}">Delete</a></li>
                                    <li><a class="dropdown-item" href="{% url 'request_peer_review' pk=post.pk %}">Request Peer Review</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="d-flex flex-wrap gap-2 mt-2">
                            {% for tag in post.tags.all %}
                                <span class="tag">{{ tag.name }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pb-3">
                    </div>
                    <span class="position-absolute top-0 end-0 p-2">
                        <span class="badge {% if post.status == 'published' %}bg-success{% else %}bg-secondary{% endif %}">{{ post.get_status_display }}</span>
                    </span>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center" role="alert">
                    No posts found. Click the '+' button to create your first post!
                </div>
            </div>
        {% endfor %}
    </div>

    <hr class="my-4">

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Presentations</div>
                <ul class="list-group list-group-flush">
                    {% for presentation in presentations %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{% url 'presentation_detail' pk=presentation.pk %}">{{ presentation.title }}</a>
                            <div>
                                <a href="{% url 'presentation_edit' pk=presentation.pk %}" class="btn btn-sm btn-outline-secondary" title="Edit Presentation">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V12h2.293l6.5-6.5-.207-.207z"/>
                                    </svg>
                                </a>
                                <a href="{% url 'presentation_delete' pk=presentation.pk %}" class="btn btn-sm btn-outline-danger" title="Delete Presentation">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                    </svg>
                                </a>
                            </div>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">No presentations yet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Portfolios</div>
                <ul class="list-group list-group-flush">
                    {% for portfolio in portfolios %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{% url 'portfolio_detail' pk=portfolio.pk %}">{{ portfolio.title }}</a>
                            <div>
                                <a href="{% url 'portfolio_edit' pk=portfolio.pk %}" class="btn btn-sm btn-outline-secondary" title="Edit Portfolio">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V12h2.293l6.5-6.5-.207-.207z"/>
                                    </svg>
                                </a>
                                <a href="{% url 'portfolio_delete' pk=portfolio.pk %}" class="btn btn-sm btn-outline-danger" title="Delete Portfolio">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                    </svg>
                                </a>
                            </div>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">No portfolios yet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>


    </div>
</div>

<!-- FAB -->
{% if user == author %}
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div class="btn-group dropup">
        <button type="button" class="btn btn-primary btn-lg rounded-circle fab-circle" data-bs-toggle="dropdown" aria-expanded="false">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
            </svg>
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#postTypeModal">New Post</a></li>
            <li><a class="dropdown-item" href="{% url 'presentation_create' %}">New Presentation</a></li>
            <li><a class="dropdown-item" href="{% url 'portfolio_create' %}">New Portfolio</a></li>
        </ul>
    </div>
</div>
{% endif %}

<!-- Post Type Modal -->
<div class="modal fade" id="postTypeModal" tabindex="-1" aria-labelledby="postTypeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="postTypeModalLabel">What are you creating?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="row">
                    <div class="col">
                        <a href="{% url 'post_create' %}?type=journal" class="text-decoration-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16">
                                <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.746c-.917-.35-2.107-.592-3.287-.81-1.094-.211-2.278-.149-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                            </svg>
                            <p>Journal Entry</p>
                        </a>
                    </div>
                    <div class="col">
                        <a href="{% url 'post_create' %}?type=photo" class="text-decoration-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16">
                                <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/>
                                <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                            </svg>
                            <p>Photo Story</p>
                        </a>
                    </div>
                    <div class="col">
                        <a href="{% url 'post_create' %}?type=video" class="text-decoration-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-film" viewBox="0 0 16 16">
                                <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"/>
                            </svg>
                            <p>Video Log</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
